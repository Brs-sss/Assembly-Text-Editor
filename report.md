# 汇编与编译原理 文本编辑器 中期提交说明文档

> 白润声 姚润茂 方钧同

## 开发环境

本应用采用win32汇编开发，使用了masm32开发工具和Irvine32链接库

## 实现原理

基本实现原理与win32编程相同，代码的主要部分在于消息循环中对于不同消息的具体处理。

整体分为编辑区和菜单栏两部分，编辑区通过edit控件实现。

具体功能的实现如下：

### 打开和保存

打开和保存的第一步相同，均为调用对应的窗口`GetOpenFileName`与`GetSaveFileName`，以获得要打开（保存）的文件名。这一步的成功与否保存在`eax`中，详细信息储存在OPENFILENAME结构体`ofn`中。之后利用循环将文件名存到`szFileName`这一变量中，以便后续使用。

获取文件名后，需要调用`CreateFile`创建对应的文件名，也即实际上的打开文件过程，若打开成功则将eax置为对应的文件句柄，因此正式的读取文件或写入文件前应当判断句柄是否合法，也即是否打开成功。

整个应用当前编辑的文本保存在`curText`变量中，打开文件时先经过一个循环将将`curText`字符数组的每个值都赋0，即清空该字符串，之后调用`ReadFile`过程把文件的内容读到`curText`中，然后通过调用`SendMessage`接口把`curText`字符串输出到edit控件上，完成显示；保存文件时没有使用`curText`字符串，而是选择使用`SendMessage`接口获取edit控件内的当前内容，并根据内容大小相应分配足够的空间以临时缓存这部分内容，之后通过调用`WriteFile`过程将缓冲区里的内容写入本地文件。具体的操作完成后，需要调用`CloseHandle`关闭文件句柄，否则可能会导致泄露。

## 小组分工

